{"version":3,"sources":["webpack://min-model/webpack/universalModuleDefinition","webpack://min-model/webpack/bootstrap","webpack://min-model/./src/indexer/base-indexer.ts","webpack://min-model/./node_modules/node-libs-browser/node_modules/events/events.js","webpack://min-model/./src/utils.ts","webpack://min-model/./src/model.ts","webpack://min-model/./src/indexer/index.ts","webpack://min-model/./src/indexer/string-indexer.ts","webpack://min-model/./src/indexer/array-indexer.ts","webpack://min-model/./src/indexer/boolean-indexer.ts","webpack://min-model/./src/indexer/date-indexer.ts","webpack://min-model/./src/indexer/number-indexer.ts","webpack://min-model/./src/indexer/object-indexer.ts","webpack://min-model/./src/queue.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","BaseIndexer","_super","sequence","prefix","min","_this","this","ready","__extends","map","exists","_f","sent","smembers","_d","keys","multi","keys_1","__values","keys_1_1","next","done","hget","exec","values","tuples","val","tuples_1","tuples_1_1","_e","__read","rtn","indexMapper","Promise","resolve","indexes","indexes_1","indexes_1_1","index","sadd","emit","add","_b","indexes_2","indexes_2_1","remove","indexes_3","indexes_3_1","srem","reindex","newValue","oldValue","_a","_search","query","chainData","keysRows","indexes_4","indexes_4_1","Set","_c","apply","push","intersect","set","sets","_i","arguments","length","ret","elem","has","reduce","a","b","set_1","set_1_1","__spread","slice","data","item","_key","keys_3","keys_2","keys_2_1","id","hgetall","filter","search","EventEmitter","_events","_maxListeners","undefined","isFunction","arg","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","TypeError","type","er","handler","len","args","listeners","error","Error","err","context","Array","on","addListener","listener","newListener","warned","console","trace","once","fired","g","removeListener","list","position","splice","removeAllListeners","listenerCount","evlistener","emitter","camel2Hyphen","str","replace","toLowerCase","hyphen2Camel","match","toUpperCase","nativeTypes","Map","deepEqual","actual","expected","opts","Date","getTime","strict","objEquiv","isUndefinedOrNull","isBuffer","x","copy","ka","kb","e","sort","String","Number","Boolean","RegExp","checkNativeType","v","nameOfNativeType","isString","isNumber","isBoolean","detectNativeType","isArray","WeakMap","WeakSet","entries","tuple","merge","target","objs","objs_1","objs_1_1","obj","events_1","utils_1","indexer_1","queue_1","prefixSymbol","sequenceSymbol","cacheSymbol","indexersSymbol","Model","keyOrContent","content","Math","random","toString","substr","constructor","runLifecycle","use","setIndexer","indexerCtor","setIndexerForColumn","extend","columns","privates","validateData","defaultData","methods","column","columnProperty","log","queue","default","class_1","fetch","sismember","setIndex","indexer","Searcher","$methods","beforeValidate","columns_1","columns_1_1","validate","this_1","__awaiter","beforeStore","hmset","hashKey","then","run","getCacheData","beforeUpdate","hset","afterUpdate","reset","columns_2","columns_2_1","key_1","beforeRemove","del","afterRemove","modelCtor","chain","getData","all","plainSearch","reject","indexOf","lastRoundData","base_indexer_1","string_indexer_1","array_indexer_1","boolean_indexer_1","date_indexer_1","number_indexer_1","object_indexer_1","typesMap","keysMap","Index","awaitForReady","ReferenceError","StringIndexer","split","from","ArrayIndexer","array","JSON","stringify","BooleanIndexer","bool","DateIndexer","date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCDay","NumberIndexer","number","ObjectIndexer","concat","Queue","running","task","curr","shift","id_1","result","catch"],"mappings":"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","file":"model.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"min-model\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"min-model\"] = factory();\n\telse\n\t\troot[\"min-model\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","import { EventEmitter } from 'events'\nimport { MinDB } from 'min'\n\nexport default class BaseIndexer extends EventEmitter {\n\n  private sequence: string\n  private prefix: string\n  key: string\n\n  private min: MinDB\n  private ready: boolean = false\n\n  constructor(sequence: string, prefix: string, key: string, min: MinDB) {\n    super()\n\n    this.sequence = sequence\n    this.prefix = prefix\n    this.key = key\n    this.min = min\n  }\n\n  public async map() {\n    const exists = await this.min.exists(this.sequence)\n    const keys = exists ? await this.min.smembers(this.sequence) : []\n\n    let multi = this.min.multi()\n    \n    for (const key of keys) {\n      multi.hget(`${this.prefix}:${key}`, this.key)\n    }\n\n    const values = await multi.exec()\n    const tuples = values.map((val, i) => [ keys[i], val ])\n\n    multi = this.min.multi()\n    for (const [ key, val ] of tuples) {\n\n      const rtn = this.indexMapper(val)\n      const indexes = await Promise.resolve(rtn)\n      for (const index of indexes) {\n        multi.sadd(`${this.sequence}:${this.key}:index:${index}`, key)\n      }\n    }\n      \n    await multi.exec()\n\n    this.ready = true\n    this.emit('ready')\n  }\n\n  public async add(key: string, val: any) {\n    const indexes = await Promise.resolve(this.indexMapper(val))\n    const multi = this.min.multi()\n\n    for (const index of indexes) {\n      multi.sadd(`${this.sequence}:${this.key}:index:${index}`, key)\n    }\n\n    await multi.exec()\n  }\n\n  public async remove(key: string, val: any) {\n    const indexes = await Promise.resolve(this.indexMapper(val))\n    const multi = this.min.multi()\n\n    for (const index of indexes) {\n      multi.srem(`${this.sequence}:${this.key}:index:${index}`, key)\n    }\n\n    await multi.exec()\n  }\n\n  public async reindex(key: string, newValue: any, oldValue: any) {\n    await this.remove(key, oldValue)\n    await this.add(key, newValue)\n    this.emit('updated')\n  }\n\n  private async _search(query: any, chainData?: any[]) {\n    const indexes = await Promise.resolve(this.indexMapper(query))\n\n    const keysRows: Set<string>[] = []\n\n    for (const index of indexes) {\n      const exists = await this.min.exists(`${this.sequence}:${this.key}:index:${index}`)\n      const keys = new Set<string>(exists ? await this.min.smembers(`${this.sequence}:${this.key}:index:${index}`) : [])\n      keysRows.push(keys)\n    }\n\n    const intersect = intersection(keysRows[0], ...keysRows.slice(1))\n\n    let data: Array<[ string, any ]> = null\n\n    if (chainData) {\n      data = chainData.map(item => [ item._key, item ] as [ string, any ])\n    } else {\n      const keys = await this.min.smembers(this.sequence)\n      const multi = this.min.multi()\n\n      for (const id of keys) {\n        multi.hgetall(`${this.prefix}:${id}`)\n      }\n\n      data = (await multi.exec()).map((val, i) => [ keys[i], val ] as [ string, any ])\n    }\n\n    return data\n      .filter(([ key ]) => intersect.has(key))\n      .map(([ key, item ]) => {\n        item._key = key\n        return item\n      })\n  }\n\n  public async search(query: any, chainData?: any[]) {\n    return await this._search(query, chainData)\n  }\n\n  // Need to be overwrite\n  indexMapper(value: any): any[] {\n    return []\n  }\n}\n\nfunction intersection(set: Set<any>, ...sets: Array<Set<any>>) {\n  const ret = new Set()\n\n  if (sets.length === 0) return set\n\n  for (const elem of set) {\n    if (sets.map(set => (set.has(elem) ? 0 : 1) as number).reduce((a, b) => a + b) == 0) {\n      ret.add(elem)\n    }\n  }\n\n  return ret\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","export function camel2Hyphen(str: string) {\n  return str.replace(/([A-Z])/g, '-$1').toLowerCase().replace(/^\\-/, '')\n}\n\nexport function hyphen2Camel(str: string) {\n  str = str.replace(/\\-(\\w{1})/g, match => match[1].toUpperCase())\n  return str.replace(/^(\\w{1})/, m => m.toUpperCase())\n}\n\nconst nativeTypes = new Map()\n\nnativeTypes.set(String, 'string')\nnativeTypes.set(Number, 'number')\nnativeTypes.set(Boolean, 'boolean')\nnativeTypes.set(Object, 'object')\nnativeTypes.set(Array, 'array')\nnativeTypes.set(Date, 'date')\nnativeTypes.set(RegExp, 'regexp')\nnativeTypes.set(Error, 'error')\n\nexport function checkNativeType(v: any) {\n  return nativeTypes.has(v)\n}\n\nexport function nameOfNativeType(v: any) {\n  return nativeTypes.has(v) ? nativeTypes.get(v) : null\n}\n\nexport function isFunction(v: any) {\n  return typeof v === 'function'\n}\n\nexport function isString(v: any) {\n  return typeof v === 'string'\n}\n\nexport function isNumber(v: any) {\n  return typeof v === 'number'\n}\n\nexport function isBoolean(v: any) {\n  return typeof v === 'boolean'\n}\n\nexport function detectNativeType(v: any) {\n  // Fallbacks\n  if (Array.isArray(v)) return Array\n  if (v instanceof Date) return Date\n  if (v instanceof RegExp) return RegExp\n  if (v instanceof Error) return Error\n  if (v instanceof (Map || Object)) return (Map || Object)\n  if (v instanceof (WeakMap || Object)) return (WeakMap || Object)\n  if (v instanceof (Set || Object)) return (Set || Object)\n  if (v instanceof (WeakSet || Object)) return (WeakSet || Object)\n\n  for (const tuple of nativeTypes.entries()) {\n    if (tuple[1] === typeof v) return tuple[0]\n  }\n\n  return Object\n}\n\nexport function merge(target: any, ...objs: any[]) {\n  for (const obj of objs) {\n    const keys = Object.keys(obj)\n    for (const key of keys) {\n      if (obj.hasOwnProperty(key)) {\n        target[key] = obj[key]\n      }\n    }\n  }\n\n  return target\n}\n\nexport function deepEqual(actual: any, expected: any, opts?: any) {\n  if (!opts) opts = {};\n  // 7.1. All identical values are equivalent, as determined by ===.\n  if (actual === expected) {\n    return true;\n\n  } else if (actual instanceof Date && expected instanceof Date) {\n    return actual.getTime() === expected.getTime();\n\n  // 7.3. Other pairs that do not both pass typeof value == 'object',\n  // equivalence is determined by ==.\n  } else if (!actual || !expected || typeof actual != 'object' && typeof expected != 'object') {\n    return opts.strict ? actual === expected : actual == expected;\n\n  // 7.4. For all other Object pairs, including Array objects, equivalence is\n  // determined by having the same number of owned properties (as verified\n  // with Object.prototype.hasOwnProperty.call), the same set of keys\n  // (although not necessarily the same order), equivalent values for every\n  // corresponding key, and an identical 'prototype' property. Note: this\n  // accounts for both named and indexed properties on Arrays.\n  } else {\n    return objEquiv(actual, expected, opts);\n  }\n}\n\nexport function isUndefinedOrNull(value: any) {\n  return value === null || value === undefined;\n}\n\nexport function isBuffer(x: any) {\n  if (!x || typeof x !== 'object' || typeof x.length !== 'number') return false;\n  if (typeof x.copy !== 'function' || typeof x.slice !== 'function') {\n    return false;\n  }\n  if (x.length > 0 && typeof x[0] !== 'number') return false;\n  return true;\n}\n\nexport function objEquiv(a: any, b: any, opts: any) {\n  var i, key;\n  if (isUndefinedOrNull(a) || isUndefinedOrNull(b))\n    return false;\n  if (a.prototype !== b.prototype) return false;\n  if (isBuffer(a)) {\n    if (!isBuffer(b)) {\n      return false;\n    }\n    if (a.length !== b.length) return false;\n    for (i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) return false;\n    }\n    return true;\n  }\n  try {\n    var ka = Object.keys(a),\n        kb = Object.keys(b);\n  } catch (e) {//happens when one is a string literal and the other isn't\n    return false;\n  }\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length != kb.length)\n    return false;\n  //the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n  //~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] != kb[i])\n      return false;\n  }\n  //equivalent values for every corresponding key, and\n  //~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!deepEqual(a[key], b[key], opts)) return false;\n  }\n  return typeof a === typeof b;\n}","import { EventEmitter } from 'events'\nimport { MinDB } from 'min'\nimport {\n  camel2Hyphen,\n  hyphen2Camel,\n  checkNativeType,\n  detectNativeType,\n  merge,\n  deepEqual,\n  isFunction, isString, isNumber, isBoolean\n} from './utils'\nimport { default as Indexer, BaseIndexer, setIndexer, setIndexerForColumn, Constructor } from './indexer'\nimport Queue from './queue'\n\nconst prefixSymbol = Symbol('prefix')\nconst sequenceSymbol = Symbol('sequence')\nconst cacheSymbol = Symbol('cache')\nconst indexersSymbol = Symbol('indexers')\n\nexport interface IMethods {\n  beforeValidate?(content: { [column: string]: any }): any\n  beforeStore?(): any\n  ready?(): any\n  beforeUpdate?(key: string, value: any, oldValue: any): any\n  afterUpdate?(key: string, value: any, oldValue: any): any\n  beforeRemove?(key: string): void\n  afterRemove?(key: string): void\n}\n\nexport default class Model extends EventEmitter {\n\n  static min: MinDB\n  static sequence: string\n  static prefix: string\n  static [indexersSymbol]: Map<string, Indexer>\n\n  static use(min: MinDB) {\n    this.min = min\n  }\n\n  static get BaseIndexer() {\n    return BaseIndexer\n  }\n\n  static setIndexer(type: string | Constructor, indexerCtor: typeof BaseIndexer) {\n    setIndexer(type, indexerCtor)\n  }\n\n  static setIndexerForColumn(key: string, indexerCtor: typeof BaseIndexer) {\n    setIndexerForColumn(`${this.sequence}:${key}`, indexerCtor)\n  }\n\n  static extend(name: string, columns: { [column: string]: any }) {\n\n    const privates = {\n      [prefixSymbol]: camel2Hyphen(name),\n      [sequenceSymbol]: camel2Hyphen(name) + 's'\n    }\n\n    const validateData: { [column: string]: any } = {}\n    const defaultData: { [column: string]: any } = {}\n    const methods: { [column: string]: Function } = {}\n\n    for (const column of Object.keys(columns)) {\n      const columnProperty = columns[column]\n\n      if (isFunction(columnProperty) && !checkNativeType(columnProperty)) {\n        methods[column] = columnProperty\n        continue\n      }\n\n      if (checkNativeType(columnProperty)) {\n        if (Array.isArray(columnProperty) && columnProperty.length === 1 && isFunction(columnProperty[0])) {\n          // TODO: Add Array of Model support\n        }\n\n        validateData[column] = columnProperty\n        defaultData[column] = columnProperty()\n      } else {\n        validateData[column] = detectNativeType(columnProperty)\n        defaultData[column] = columnProperty\n      }\n    }\n\n    const toStringTag = hyphen2Camel(name)\n    console.log(name, toStringTag)\n\n    const queue = new Queue()\n\n    return class extends Model {\n\n      static get modelName() {\n         return toStringTag\n      }\n\n      static get prefix() {\n        return privates[prefixSymbol]\n      }\n\n      static get sequence() {\n        return privates[sequenceSymbol]\n      }\n\n      static get validateData() {\n        return validateData\n      }\n\n      static get defaultData() {\n        return defaultData\n      }\n\n      get $methods() {\n        return methods\n      }\n\n      get [Symbol.toStringTag]() {\n        return toStringTag\n      }\n\n      get min() {\n        return Model.min\n      }\n\n      get queue() {\n        return queue\n      }\n    }\n\n  }\n\n  static async fetch(key: string) {\n    const exists = await this.min.sismember(this.sequence, key)\n    if (!exists) {\n      throw new Error('Object not found.')\n    }\n\n    const data = await this.min.hgetall(`${this.prefix}:${key}`)\n    return new this(key, data)\n  }\n\n  static setIndex(column: string) {\n    if (!this[indexersSymbol]) {\n      this[indexersSymbol] = new Map<string, Indexer>()\n    }\n\n    const type = (this as any)['validateData'][column]\n    const indexer = new Indexer(this.sequence, this.prefix, column, type, this.min)\n\n    this[indexersSymbol].set(column, indexer)\n\n    return indexer\n  }\n\n  static search(column: string, query: any) {\n    return new Searcher(column, query, this)\n  }\n\n  public key: string\n  [cacheSymbol]: { [column: string]: any } = {}\n\n  constructor(key: string, content?: { [column: string]: any })\n  constructor(content?: { [column: string]: any })\n\n  constructor(keyOrContent: string | { [column: string]: any }, content?: { [column: string]: any }) {\n    super()\n\n    if (keyOrContent && content) {\n      this.key = keyOrContent as string\n      this[cacheSymbol] = content\n    } else {\n      if (!content) {\n        content = keyOrContent as { [column: string]: any }\n        this.key = Math.random().toString(32).substr(2)\n      } else {\n        this.key = keyOrContent as string || Math.random().toString(32).substr(2)\n      }\n\n      this[cacheSymbol] = merge({}, (this.constructor as any)['defaultData'])\n  \n    }\n\n    this.runLifecycle(content)\n  }\n\n  runLifecycle(content?: { [column: string]: any }) {\n\n    // Lifecyle: beforeValidate\n    if (this.$methods.beforeValidate) {\n      const rtn = this.$methods.beforeValidate.call(this, content)\n\n      if (rtn) {\n        content = rtn\n      }\n    }\n\n    const columns = Object.keys(content)\n\n    for (const key of columns) {\n      if (!this.validate(key, content[key])) {\n        throw new TypeError(`Type validate failed on column \"${key}\".`)\n      }\n    }\n\n    this[cacheSymbol] = merge(this[cacheSymbol], content)\n\n    for (const name of Object.keys(this.$methods)) {\n      (this as any)[name] = (...args: any[]) => (this.$methods as any)[name].call(this, ...args)\n    }\n\n    this.queue.push(async () => {\n      // Lifecyle: beforeStore\n      if (this.$methods.beforeStore) {\n        this.$methods.beforeStore.call(this)\n      }\n\n      await this.min.sadd((this.constructor as any)['sequence'], this.key)\n      await this.min.hmset(this.hashKey, this[cacheSymbol])\n      \n      for (const key of Object.keys(this[cacheSymbol])) {\n        if ((this.constructor as any)[indexersSymbol] && (this.constructor as any)[indexersSymbol].has(key)) {\n          await ((this.constructor as any)[indexersSymbol] as Map<string, BaseIndexer>).get(key).add(this.key, this[cacheSymbol][key])\n        }\n      }\n    })\n      .then(() => {\n        if (this.$methods.ready) {\n          this.$methods.ready.call(this)\n        }\n    \n        this.emit('ready')\n      })\n\n    this.queue.run()\n  }\n\n  getCacheData(key: string = null) {\n    if (!key) {\n      return this[cacheSymbol]\n    } else {\n      return this[cacheSymbol][key]\n    }\n  }\n\n  get hashKey() {\n    return (this.constructor as any)['prefix'] + ':' + this.key\n  }\n\n  get $methods(): IMethods {\n    return {}\n  }\n\n  get queue(): Queue {\n    return null\n  }\n\n  get min(): MinDB {\n    return null\n  }\n\n  validate(key: string, value: any) {\n    switch((this.constructor as any)['validateData'][key]) {\n      case String:\n        return isString(value)\n        break\n\n      case Number:\n        return isNumber(value)\n        break\n\n      case Boolean:\n        return isBoolean(value)\n        break\n\n      default:\n        return value instanceof ((this.constructor as any)['validateData'][key] || Object)\n    }\n  }\n\n  async get(key: string) {\n    if (this[cacheSymbol][key]) {\n      return this[cacheSymbol][key]\n    }\n\n    const value = await this.min.hget(this.hashKey, key)\n    this[cacheSymbol][key] = value\n\n    return value\n  }\n\n  async set(key: string, value: any) {\n    if (!this.validate(key, value)) {\n      throw new TypeError('Type validate failed.')\n    }\n\n    const oldValue = this[cacheSymbol][key]\n\n    // Lifecyle: beforeUpdate\n    if (this.$methods.beforeUpdate) {\n      this.$methods.beforeUpdate.call(this, key, value, oldValue)\n    }\n\n    this[cacheSymbol][key] = value\n\n    await this.min.hset(this.hashKey, key, value)\n\n    if ((this.constructor as any)[indexersSymbol] && (this.constructor as any)[indexersSymbol].has(key)) {\n      const indexer = ((this.constructor as any)[indexersSymbol] as Map<string, BaseIndexer>).get(key)\n\n      await indexer.reindex(this.key, value, oldValue)\n    }\n\n    // Lifecyle: afterUpdate\n    if (this.$methods.afterUpdate) {\n      this.$methods.afterUpdate.call(this, key, value, oldValue)\n    }\n\n    return [ key, value ]\n  }\n\n  async reset(key?: string) {\n    if (key) {\n      return await this.set(key, (this.constructor as any)['defaultData'][key])\n    }\n\n    const columns = Object.keys((this.constructor as any)['defaultData'])\n\n    for (const key of columns) {\n      await this.set(key, (this.constructor as any)['defaultData'][key])\n    }\n  }\n\n  async remove() {\n    // Lifecyle: beforeRemove\n    if (this.$methods.beforeRemove) {\n      this.$methods.beforeRemove.call(this)\n    }\n\n    await this.min.srem((this.constructor as any)['sequence'], this.key)\n    await this.min.del(this.hashKey)\n\n    for (const key of Object.keys(this[cacheSymbol])) {\n      if ((this.constructor as any)[indexersSymbol] && (this.constructor as any)[indexersSymbol].has(key)) {\n        const indexer = ((this.constructor as any)[indexersSymbol] as Map<string, BaseIndexer>).get(key)\n  \n        await indexer.remove(this.key, this[cacheSymbol][key])\n      }\n    }\n\n    this.key = null\n    this[cacheSymbol] = null\n\n    // Lifecyle: afterRemove\n    if (this.$methods.afterRemove) {\n      this.$methods.afterRemove.call(this)\n    }\n  }\n\n}\n\nexport class Searcher extends EventEmitter {\n\n  private chain: Array<[ string, any ]> = []\n  private modelCtor: typeof Model\n\n  constructor(column: string, query: any, modelCtor: typeof Model) {\n    super()\n\n    this.chain.push([ column, query ])\n    this.modelCtor = modelCtor\n  }\n\n  search(column: string, query: any) {\n    this.chain.push([ column, query ])\n  }\n\n  private async getData(keys: string[]) {\n    return (await Promise.all(keys.map(key => this.modelCtor.min.hgetall(`${this.modelCtor.prefix}:${key}`))))\n      .map((item: any, i: number) => {\n        item._key = keys[i]\n        return item\n      })\n  }\n\n  private async plainSearch(column: string, query: any, chainData?: any[]) {\n    if ((this.modelCtor as any)['validateData'][column] !== detectNativeType(query)) {\n      return Promise.reject(new TypeError('Type wrong'))\n    }\n\n    if (!chainData) {\n      const keys = await this.modelCtor.min.smembers(this.modelCtor.sequence)\n      chainData = await this.getData(keys)\n    }\n\n    const values = await Promise.all(chainData.map(({ _key }) => this.modelCtor.min.hget(`${this.modelCtor.prefix}:${_key}`, column)))\n    const tuples = values.map((value, i) => [ chainData[i]._key, value ])\n\n    const keys = tuples\n      .filter(([ key, value ]) => {\n        if ((this.modelCtor as any)['validateData'][column] === String) {\n          return value.indexOf(query) >= 0\n        }\n\n        return deepEqual(value, query)\n      })\n      .map(([ key ]) => key)\n\n    return this.getData(keys)\n  }\n\n  async exec() {\n    let lastRoundData: any[]\n\n    for (const [ column, query ] of this.chain) {\n      if (this.modelCtor[indexersSymbol].has(column)) {\n        const indexer = this.modelCtor[indexersSymbol].get(column)\n        lastRoundData = await indexer.search(query, lastRoundData)\n      } else {\n        lastRoundData = await this.plainSearch(column, query, lastRoundData)\n      }\n    }\n\n    return lastRoundData.map(item => {\n      const key = item._key\n      delete item._key\n      return new this.modelCtor(key, item)\n    })\n  }\n\n}","export { default as BaseIndexer } from './base-indexer'\n\nimport { EventEmitter } from 'events'\nimport BaseIndexer from './base-indexer'\nimport StringIndexer from './string-indexer'\nimport ArrayIndexer from './array-indexer'\nimport BooleanIndexer from './boolean-indexer'\nimport DateIndexer from './date-indexer'\nimport NumberIndexer from './number-indexer'\nimport ObjectIndexer from './object-indexer'\n\nimport { MinDB } from 'min'\nimport { nameOfNativeType } from '../utils'\n\nexport type Constructor = StringConstructor | NumberConstructor | BooleanConstructor | ObjectConstructor | ArrayConstructor | DateConstructor | ErrorConstructor\n\nconst typesMap = new Map<string | Constructor, typeof BaseIndexer>()\n\ntypesMap.set('string', StringIndexer)\ntypesMap.set(String, StringIndexer)\ntypesMap.set('array', ArrayIndexer)\ntypesMap.set(Array, ArrayIndexer)\ntypesMap.set('boolean', BooleanIndexer)\ntypesMap.set('date', DateIndexer)\ntypesMap.set(Date, DateIndexer)\ntypesMap.set('number', NumberIndexer)\ntypesMap.set(Number, NumberIndexer)\ntypesMap.set('object', ObjectIndexer)\ntypesMap.set(Object, ObjectIndexer)\n\nconst keysMap = new Map()\n\nexport default class Index extends EventEmitter {\n\n  private ready: boolean = false\n  private indexer: BaseIndexer\n\n  constructor(sequence: string, prefix: string, key: string, type: string | Constructor, min: MinDB) {\n    super()\n\n    switch (true) {\n      case keysMap.has(`${sequence}:${key}`):\n        this.indexer = new (keysMap.get(`${sequence}:${key}`))(sequence, prefix, key, min)\n        break\n\n      case typesMap.has(type):\n        this.indexer = new (typesMap.get(type))(sequence, prefix, key, min)\n        break\n      \n      default:\n        throw new Error('Not support for this type.')\n    }\n\n    this.indexer.map()\n    this.indexer\n      .on('ready', () => {\n        this.ready = true\n        this.emit('ready')\n      })\n      .on('updated', () => this.emit('updated'))\n  }\n\n  awaitForReady() {\n    if (this.ready) {\n      return Promise.resolve(true)\n    }\n\n    return new Promise<boolean>(resolve => {\n      this.once('ready', () => resolve(true))\n    })\n  }\n\n  async add(key: string, value: any) {\n    if (!this.indexer) throw new ReferenceError('There not indexer available.')\n\n    await this.awaitForReady()\n\n    return await this.indexer.add(key, value)\n  }\n\n  async remove(key: string, value: any) {\n    if (!this.indexer) throw new ReferenceError('There not indexer available.')\n\n    await this.awaitForReady()\n\n    return await this.indexer.remove(key, value)\n  }\n\n  async reindex(key: string, newValue: any, oldValue: any) {\n    if (!this.indexer) throw new ReferenceError('There not indexer available.')\n\n    await this.awaitForReady()\n\n    return await this.indexer.reindex(key, newValue, oldValue)\n  }\n\n  async search(query: any, chainData?: any[]) {\n    if (!this.indexer) throw new ReferenceError('There not indexer available.')\n\n    await this.awaitForReady()\n\n    return await this.indexer.search(query, chainData)\n  }\n\n}\n\nexport function setIndexer(type: string | Constructor, indexerCtor: typeof BaseIndexer) {\n  typesMap.set(type, indexerCtor)\n  typesMap.set(nameOfNativeType(type), indexerCtor)\n}\n\nexport function setIndexerForColumn(key: string, indexerCtor: typeof BaseIndexer) {\n  keysMap.set(key, indexerCtor)\n}","import BaseIndexer from './base-indexer'\n\nexport default class StringIndexer extends BaseIndexer {\n\n  indexMapper(str: string) {\n    const set = new Set(\n      str\n        .split(/[\\s,\\.;\\:\"'!]/)\n        .filter(Boolean)\n        .map(s => s.toLowerCase())\n    )\n\n    return Array.from(set)\n  }\n\n}\n","import BaseIndexer from './base-indexer'\n\nexport default class ArrayIndexer extends BaseIndexer {\n\n  indexMapper(array: any[]) {\n    return array.map(item => JSON.stringify(item))\n  }\n\n}","import BaseIndexer from './base-indexer'\n\nexport default class BooleanIndexer extends BaseIndexer {\n\n  // Overwrite ::indexMapper\n  indexMapper(bool: boolean) {\n    return [ bool ]\n  }\n\n}","import BaseIndexer from './base-indexer'\n\nexport default class DateIndexer extends BaseIndexer {\n\n  // Overwrite ::indexMapper\n  indexMapper(date: Date) {\n    return [\n      date.getUTCFullYear(),\n      date.getUTCMonth(),\n      date.getUTCDate(),\n      date.getUTCDay()\n    ]\n  }\n\n  async search(query: Date, chainData: any[]) {\n    const results: any[] = await this.search(query, chainData)\n\n    return results.filter(item => item[this.key].getTime() === query.getTime())\n  }\n}","import BaseIndexer from './base-indexer'\n\nexport default class NumberIndexer extends BaseIndexer {\n\n  // Overwrite ::indexMapper\n  indexMapper(number: number) {\n    return [\n      number % 3,\n      number % 5,\n      number % 7\n    ]\n  }\n\n  async search(query: number, chainData: any[]) {\n    const results: any[] = await this.search(query, chainData)\n    return results.filter(item => item[this.key] === query)\n  }\n}","import BaseIndexer from './base-indexer'\n\nexport default class ObjectIndexer extends BaseIndexer {\n\n  // Overwrite ::indexMapper\n  indexMapper(obj: any) {\n    return Object.keys(obj)\n      .map(key => [ key, JSON.stringify(obj[key]) ])\n      .reduce((a, b) => a.concat(b))\n  }\n\n}","import { EventEmitter } from 'events'\n\ninterface ITaskFunc {\n  (...args: any[]): Promise<any>\n}\n\nexport default class Queue extends EventEmitter {\n\n  private queue: Array<{\n    task: ITaskFunc,\n    id: string\n  }> = []\n  private running = false\n\n  constructor() {\n    super()\n  }\n\n  push(task: ITaskFunc) {\n    const id = Math.random().toString(32).substr(2)\n\n    this.queue.push({\n      task, id\n    })\n\n    return new Promise((resolve, reject) => {\n      this.once(`task:${id}:resolve`, resolve)\n      this.once(`task:${id}:reject`, reject)\n    })\n  }\n\n  run(running?: boolean) {\n    if (!running) if (this.running) return this\n\n    const curr = this.queue.shift()\n\n    if (curr) {\n      const { task, id } = curr\n      this.running = true\n\n      task()\n        .then(result => {\n          this.emit(`task:${id}:resolve`, result)\n          this.run(this.running)\n        })\n        .catch(err => {\n          this.emit(`task:${id}:reject`, err)\n          this.run(this.running)\n        })\n    } else {\n      this.running = false\n      this.emit('idle')\n    }\n\n    return this\n  }\n\n  get hasNext() {\n    return this.queue.length !== 0\n  }\n}"],"sourceRoot":""}