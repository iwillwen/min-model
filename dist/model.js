!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("min-model",[],t):"object"==typeof exports?exports["min-model"]=t():e["min-model"]=t()}(window,function(){return function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__awaiter||function(o,s,u,a){return new(u||(u=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},k=this&&this.__generator||function(r,n){var i,o,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,o=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=n.call(r,u)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},P=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},S=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},j=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(S(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(o){function e(e,t,r,n){var i=o.call(this)||this;return i.ready=!1,i.sequence=e,i.prefix=t,i.key=r,i.min=n,i}return i(e,o),e.prototype.map=function(){return s(this,void 0,void 0,function(){var t,r,n,i,o,s,u,a,c,l,f,h,p,y,d,v,b,m,_,w,x,g,O,j;return k(this,function(e){switch(e.label){case 0:return[4,this.min.exists(this.sequence)];case 1:return e.sent()?[4,this.min.smembers(this.sequence)]:[3,3];case 2:return a=e.sent(),[3,4];case 3:a=[],e.label=4;case 4:u=a,c=this.min.multi();try{for(l=P(u),f=l.next();!f.done;f=l.next())b=f.value,c.hget(this.prefix+":"+b,this.key)}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return[4,c.exec()];case 5:h=e.sent(),p=h.map(function(e,t){return[u[t],e]}),c=this.min.multi(),e.label=6;case 6:e.trys.push([6,11,12,13]),y=P(p),d=y.next(),e.label=7;case 7:return d.done?[3,10]:(v=S(d.value,2),b=v[0],m=v[1],_=this.indexMapper(m),[4,Promise.resolve(_)]);case 8:w=e.sent();try{for(x=P(w),g=x.next();!g.done;g=x.next())O=g.value,c.sadd(this.sequence+":"+this.key+":index:"+O,b)}catch(e){o={error:e}}finally{try{g&&!g.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}e.label=9;case 9:return d=y.next(),[3,7];case 10:return[3,13];case 11:return j=e.sent(),n={error:j},[3,13];case 12:try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}return[7];case 13:return[4,c.exec()];case 14:return e.sent(),this.ready=!0,this.emit("ready"),[2]}})})},e.prototype.add=function(a,c){return s(this,void 0,void 0,function(){var t,r,n,i,o,s,u;return k(this,function(e){switch(e.label){case 0:return[4,Promise.resolve(this.indexMapper(c))];case 1:n=e.sent(),i=this.min.multi();try{for(o=P(n),s=o.next();!s.done;s=o.next())u=s.value,i.sadd(this.sequence+":"+this.key+":index:"+u,a)}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return[4,i.exec()];case 2:return e.sent(),[2]}})})},e.prototype.remove=function(a,c){return s(this,void 0,void 0,function(){var t,r,n,i,o,s,u;return k(this,function(e){switch(e.label){case 0:return[4,Promise.resolve(this.indexMapper(c))];case 1:n=e.sent(),i=this.min.multi();try{for(o=P(n),s=o.next();!s.done;s=o.next())u=s.value,i.srem(this.sequence+":"+this.key+":index:"+u,a)}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return[4,i.exec()];case 2:return e.sent(),[2]}})})},e.prototype.reindex=function(t,r,n){return s(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:return[4,this.remove(t,n)];case 1:return e.sent(),[4,this.add(t,r)];case 2:return e.sent(),this.emit("updated"),[2]}})})},e.prototype._search=function(g,O){return s(this,void 0,void 0,function(){var t,r,n,i,o,s,u,a,c,l,f,h,p,y,d,v,b,m,_,w,x;return k(this,function(e){switch(e.label){case 0:return[4,Promise.resolve(this.indexMapper(g))];case 1:o=e.sent(),s=[],e.label=2;case 2:e.trys.push([2,10,11,12]),u=P(o),a=u.next(),e.label=3;case 3:return a.done?[3,9]:(c=a.value,[4,this.min.exists(this.sequence+":"+this.key+":index:"+c)]);case 4:return l=e.sent(),h=Set.bind,l?[4,this.min.smembers(this.sequence+":"+this.key+":index:"+c)]:[3,6];case 5:return p=e.sent(),[3,7];case 6:p=[],e.label=7;case 7:f=new(h.apply(Set,[void 0,p])),s.push(f),e.label=8;case 8:return a=u.next(),[3,3];case 9:return[3,12];case 10:return y=e.sent(),t={error:y},[3,12];case 11:try{a&&!a.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}return[7];case 12:return d=function(e){for(var t,r,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=new Set;if(0===n.length)return e;var s=function(t){0==n.map(function(e){return e.has(t)?0:1}).reduce(function(e,t){return e+t})&&o.add(t)};try{for(var u=P(e),a=u.next();!a.done;a=u.next()){var c=a.value;s(c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return o}.apply(void 0,j([s[0]],s.slice(1))),v=null,O?(v=O.map(function(e){return[e._key,e]}),[3,16]):[3,13];case 13:return[4,this.min.smembers(this.sequence)];case 14:b=e.sent(),m=this.min.multi();try{for(_=P(b),w=_.next();!w.done;w=_.next())x=w.value,m.hgetall(this.prefix+":"+x)}catch(e){n={error:e}}finally{try{w&&!w.done&&(i=_.return)&&i.call(_)}finally{if(n)throw n.error}}return[4,m.exec()];case 15:v=e.sent().map(function(e,t){return[b[t],e]}),e.label=16;case 16:return[2,v.filter(function(e){var t=S(e,1)[0];return d.has(t)}).map(function(e){var t=S(e,2),r=t[0],n=t[1];return n._key=r,n})]}})})},e.prototype.search=function(t,r){return s(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:return[4,this._search(t,r)];case 1:return[2,e.sent()]}})})},e.prototype.indexMapper=function(e){return[]},e}(r(1).EventEmitter);t.default=o},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function c(e){return"object"==typeof e&&null!==e}function l(e){return void 0===e}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,i,o,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(l(r=this._events[e]))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),r.apply(this,i)}else if(c(r))for(i=Array.prototype.slice.call(arguments,1),n=(s=r.slice()).length,o=0;o<n;o++)s[o].apply(this,i);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?c(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,c(this._events[e])&&!this._events[e].warned&&(r=l(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!a(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,i,o;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(r=this._events[e]).length,n=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(c(r)){for(o=i;0<o--;)if(r[o]===t||r[o].listener&&r[o].listener===t){n=o;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";var y=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0}),t.camel2Hyphen=function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^\-/,"")},t.hyphen2Camel=function(e){return(e=e.replace(/\-(\w{1})/g,function(e){return e[1].toUpperCase()})).replace(/^(\w{1})/,function(e){return e.toUpperCase()})};var s=new Map;function u(e,t,r){return r||(r={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?r.strict?e===t:e==t:n(e,t,r))}function a(e){return null==e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(0<e.length&&"number"!=typeof e[0]))}function n(e,t,r){var n,i;if(a(e)||a(t))return!1;if(e.prototype!==t.prototype)return!1;if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}try{var o=Object.keys(e),s=Object.keys(t)}catch(e){return!1}if(o.length!=s.length)return!1;for(o.sort(),s.sort(),n=o.length-1;0<=n;n--)if(o[n]!=s[n])return!1;for(n=o.length-1;0<=n;n--)if(!u(e[i=o[n]],t[i],r))return!1;return typeof e==typeof t}s.set(String,"string"),s.set(Number,"number"),s.set(Boolean,"boolean"),s.set(Object,"object"),s.set(Array,"array"),s.set(Date,"date"),s.set(RegExp,"regexp"),s.set(Error,"error"),t.checkNativeType=function(e){return s.has(e)},t.nameOfNativeType=function(e){return s.has(e)?s.get(e):null},t.isFunction=function(e){return"function"==typeof e},t.isString=function(e){return"string"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isBoolean=function(e){return"boolean"==typeof e},t.detectNativeType=function(e){var t,r;if(Array.isArray(e))return Array;if(e instanceof Date)return Date;if(e instanceof RegExp)return RegExp;if(e instanceof Error)return Error;if(e instanceof(Map||Object))return Map||Object;if(e instanceof(WeakMap||Object))return WeakMap||Object;if(e instanceof(Set||Object))return Set||Object;if(e instanceof(WeakSet||Object))return WeakSet||Object;try{for(var n=y(s.entries()),i=n.next();!i.done;i=n.next()){var o=i.value;if(o[1]===typeof e)return o[0]}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return Object},t.merge=function(e){for(var t,r,n,i,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u=y(o),a=u.next();!a.done;a=u.next()){var c=a.value,l=Object.keys(c);try{for(var f=y(l),h=f.next();!h.done;h=f.next()){var p=h.value;c.hasOwnProperty(p)&&(e[p]=c[p])}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return e},t.deepEqual=u,t.isUndefinedOrNull=a,t.isBuffer=c,t.objEquiv=n},function(e,t,r){"use strict";var n,i,v=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),b=this&&this.__awaiter||function(o,s,u,a){return new(u||(u=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},m=this&&this.__generator||function(r,n){var i,o,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,o=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=n.call(r,u)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},_=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},f=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},w=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),x=r(2),s=r(4),g=r(11),O=Symbol("prefix"),j=Symbol("sequence"),k=Symbol("cache"),P=Symbol("indexers"),u=function(n){function d(e,t){var r=n.call(this)||this;return r[i]={},r[k]=e&&t?(r.key=e,t):(r.key=t?e||Math.random().toString(32).substr(2):(t=e,Math.random().toString(32).substr(2)),x.merge({},r.constructor.defaultData)),r.runLifecycle(t),r}return v(d,n),d.use=function(e){this.min=e},Object.defineProperty(d,"BaseIndexer",{get:function(){return s.BaseIndexer},enumerable:!0,configurable:!0}),d.setIndexer=function(e,t){s.setIndexer(e,t)},d.setIndexerForColumn=function(e,t){s.setIndexerForColumn(this.sequence+":"+e,t)},d.extend=function(e,t){var r,n,i,o=((r={})[O]=x.camel2Hyphen(e),r[j]=x.camel2Hyphen(e)+"s",r),s={},u={},a={};try{for(var c=_(Object.keys(t)),l=c.next();!l.done;l=c.next()){var f=l.value,h=t[f];!x.isFunction(h)||x.checkNativeType(h)?x.checkNativeType(h)?(Array.isArray(h)&&1===h.length&&x.isFunction(h[0]),s[f]=h,u[f]=h()):(s[f]=x.detectNativeType(h),u[f]=h):a[f]=h}}catch(e){n={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}var p=x.hyphen2Camel(e);console.log(e,p);var y=new g.default;return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return v(t,e),Object.defineProperty(t,"modelName",{get:function(){return p},enumerable:!0,configurable:!0}),Object.defineProperty(t,"prefix",{get:function(){return o[O]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"sequence",{get:function(){return o[j]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"validateData",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(t,"defaultData",{get:function(){return u},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$methods",{get:function(){return a},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"min",{get:function(){return d.min},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queue",{get:function(){return y},enumerable:!0,configurable:!0}),t}(d)},d.fetch=function(r){return b(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return[4,this.min.sismember(this.sequence,r)];case 1:if(!e.sent())throw new Error("Object not found.");return[4,this.min.hgetall(this.prefix+":"+r)];case 2:return t=e.sent(),[2,new this(r,t)]}})})},d.setIndex=function(e){this[P]||(this[P]=new Map);var t=this.validateData[e],r=new s.default(this.sequence,this.prefix,e,t,this.min);return this[P].set(e,r),r},d.search=function(e,t){return new a(e,t,this)},d.prototype.runLifecycle=function(e){var t,r,n,i,o=this;if(this.$methods.beforeValidate){var s=this.$methods.beforeValidate.call(this,e);s&&(e=s)}var u=Object.keys(e);try{for(var a=_(u),c=a.next();!c.done;c=a.next()){var l=c.value;if(!this.validate(l,e[l]))throw new TypeError('Type validate failed on column "'+l+'".')}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}this[k]=x.merge(this[k],e);var f=function(n){h[n]=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=o.$methods[n]).call.apply(e,w([o],t))}},h=this;try{for(var p=_(Object.keys(this.$methods)),y=p.next();!y.done;y=p.next()){f(y.value)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}this.queue.push(function(){return b(o,void 0,void 0,function(){var t,r,n,i,o,s;return m(this,function(e){switch(e.label){case 0:return this.$methods.beforeStore&&this.$methods.beforeStore.call(this),[4,this.min.sadd(this.constructor.sequence,this.key)];case 1:return e.sent(),[4,this.min.hmset(this.hashKey,this[k])];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=_(Object.keys(this[k])),i=n.next(),e.label=4;case 4:return i.done?[3,7]:(o=i.value,this.constructor[P]&&this.constructor[P].has(o)?[4,this.constructor[P].get(o).add(this.key,this[k][o])]:[3,6]);case 5:e.sent(),e.label=6;case 6:return i=n.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),t={error:s},[3,10];case 9:try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}return[7];case 10:return[2]}})})}).then(function(){o.$methods.ready&&o.$methods.ready.call(o),o.emit("ready")}),this.queue.run()},d.prototype.getCacheData=function(e){return void 0===e&&(e=null),e?this[k][e]:this[k]},Object.defineProperty(d.prototype,"hashKey",{get:function(){return this.constructor.prefix+":"+this.key},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"$methods",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"queue",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"min",{get:function(){return null},enumerable:!0,configurable:!0}),d.prototype.validate=function(e,t){switch(this.constructor.validateData[e]){case String:return x.isString(t);case Number:return x.isNumber(t);case Boolean:return x.isBoolean(t);default:return t instanceof(this.constructor.validateData[e]||Object)}},d.prototype.get=function(r){return b(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:return this[k][r]?[2,this[k][r]]:[4,this.min.hget(this.hashKey,r)];case 1:return t=e.sent(),[2,this[k][r]=t]}})})},d.prototype.set=function(r,n){return b(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:if(!this.validate(r,n))throw new TypeError("Type validate failed.");return t=this[k][r],this.$methods.beforeUpdate&&this.$methods.beforeUpdate.call(this,r,n,t),this[k][r]=n,[4,this.min.hset(this.hashKey,r,n)];case 1:return e.sent(),this.constructor[P]&&this.constructor[P].has(r)?[4,this.constructor[P].get(r).reindex(this.key,n,t)]:[3,3];case 2:e.sent(),e.label=3;case 3:return this.$methods.afterUpdate&&this.$methods.afterUpdate.call(this,r,n,t),[2,[r,n]]}})})},d.prototype.reset=function(a){return b(this,void 0,void 0,function(){var t,r,n,i,o,s,u;return m(this,function(e){switch(e.label){case 0:return a?[4,this.set(a,this.constructor.defaultData[a])]:[3,2];case 1:return[2,e.sent()];case 2:n=Object.keys(this.constructor.defaultData),e.label=3;case 3:e.trys.push([3,8,9,10]),i=_(n),o=i.next(),e.label=4;case 4:return o.done?[3,7]:(s=o.value,[4,this.set(s,this.constructor.defaultData[s])]);case 5:e.sent(),e.label=6;case 6:return o=i.next(),[3,4];case 7:return[3,10];case 8:return u=e.sent(),t={error:u},[3,10];case 9:try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}return[7];case 10:return[2]}})})},d.prototype.remove=function(){return b(this,void 0,void 0,function(){var t,r,n,i,o,s;return m(this,function(e){switch(e.label){case 0:return this.$methods.beforeRemove&&this.$methods.beforeRemove.call(this),[4,this.min.srem(this.constructor.sequence,this.key)];case 1:return e.sent(),[4,this.min.del(this.hashKey)];case 2:e.sent(),e.label=3;case 3:e.trys.push([3,8,9,10]),n=_(Object.keys(this[k])),i=n.next(),e.label=4;case 4:return i.done?[3,7]:(o=i.value,this.constructor[P]&&this.constructor[P].has(o)?[4,this.constructor[P].get(o).remove(this.key,this[k][o])]:[3,6]);case 5:e.sent(),e.label=6;case 6:return i=n.next(),[3,4];case 7:return[3,10];case 8:return s=e.sent(),t={error:s},[3,10];case 9:try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}return[7];case 10:return this.key=null,this[k]=null,this.$methods.afterRemove&&this.$methods.afterRemove.call(this),[2]}})})},d}(o.EventEmitter);i=k,t.default=u;var a=function(i){function e(e,t,r){var n=i.call(this)||this;return n.chain=[],n.chain.push([e,t]),n.modelCtor=r,n}return v(e,i),e.prototype.search=function(e,t){this.chain.push([e,t])},e.prototype.getData=function(r){return b(this,void 0,void 0,function(){var t=this;return m(this,function(e){switch(e.label){case 0:return[4,Promise.all(r.map(function(e){return t.modelCtor.min.hgetall(t.modelCtor.prefix+":"+e)}))];case 1:return[2,e.sent().map(function(e,t){return e._key=r[t],e})]}})})},e.prototype.plainSearch=function(s,u,a){return b(this,void 0,void 0,function(){var t,r,n,i,o=this;return m(this,function(e){switch(e.label){case 0:return this.modelCtor.validateData[s]!==x.detectNativeType(u)?[2,Promise.reject(new TypeError("Type wrong"))]:a?[3,3]:[4,this.modelCtor.min.smembers(this.modelCtor.sequence)];case 1:return t=e.sent(),[4,this.getData(t)];case 2:a=e.sent(),e.label=3;case 3:return[4,Promise.all(a.map(function(e){var t=e._key;return o.modelCtor.min.hget(o.modelCtor.prefix+":"+t,s)}))];case 4:return r=e.sent(),n=r.map(function(e,t){return[a[t]._key,e]}),i=n.filter(function(e){var t=f(e,2),r=(t[0],t[1]);return o.modelCtor.validateData[s]===String?0<=r.indexOf(u):x.deepEqual(r,u)}).map(function(e){return f(e,1)[0]}),[2,this.getData(i)]}})})},e.prototype.exec=function(){return b(this,void 0,void 0,function(){var t,r,n,i,o,s,u,a,c,l=this;return m(this,function(e){switch(e.label){case 0:e.trys.push([0,7,8,9]),i=_(this.chain),o=i.next(),e.label=1;case 1:return o.done?[3,6]:(s=f(o.value,2),u=s[0],a=s[1],this.modelCtor[P].has(u)?[4,this.modelCtor[P].get(u).search(a,n)]:[3,3]);case 2:return n=e.sent(),[3,5];case 3:return[4,this.plainSearch(u,a,n)];case 4:n=e.sent(),e.label=5;case 5:return o=i.next(),[3,1];case 6:return[3,9];case 7:return c=e.sent(),t={error:c},[3,9];case 8:try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}return[7];case 9:return[2,n.map(function(e){var t=e._key;return delete e._key,new l.modelCtor(t,e)})]}})})},e}(o.EventEmitter);t.Searcher=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(o,s,u,a){return new(u||(u=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},u=this&&this.__generator||function(r,n){var i,o,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,o=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=n.call(r,u)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(0);t.BaseIndexer=s.default;var a=r(1),c=r(5),l=r(6),f=r(7),h=r(8),p=r(9),y=r(10),d=r(2),v=new Map;v.set("string",c.default),v.set(String,c.default),v.set("array",l.default),v.set(Array,l.default),v.set("boolean",f.default),v.set("date",h.default),v.set(Date,h.default),v.set("number",p.default),v.set(Number,p.default),v.set("object",y.default),v.set(Object,y.default);var b=new Map,m=function(s){function e(e,t,r,n,i){var o=s.call(this)||this;switch(!(o.ready=!1)){case b.has(e+":"+r):o.indexer=new(b.get(e+":"+r))(e,t,r,i);break;case v.has(n):o.indexer=new(v.get(n))(e,t,r,i);break;default:throw new Error("Not support for this type.")}return o.indexer.map(),o.indexer.on("ready",function(){o.ready=!0,o.emit("ready")}).on("updated",function(){return o.emit("updated")}),o}return i(e,s),e.prototype.awaitForReady=function(){var t=this;return this.ready?Promise.resolve(!0):new Promise(function(e){t.once("ready",function(){return e(!0)})})},e.prototype.add=function(t,r){return o(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:if(!this.indexer)throw new ReferenceError("There not indexer available.");return[4,this.awaitForReady()];case 1:return e.sent(),[4,this.indexer.add(t,r)];case 2:return[2,e.sent()]}})})},e.prototype.remove=function(t,r){return o(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:if(!this.indexer)throw new ReferenceError("There not indexer available.");return[4,this.awaitForReady()];case 1:return e.sent(),[4,this.indexer.remove(t,r)];case 2:return[2,e.sent()]}})})},e.prototype.reindex=function(t,r,n){return o(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:if(!this.indexer)throw new ReferenceError("There not indexer available.");return[4,this.awaitForReady()];case 1:return e.sent(),[4,this.indexer.reindex(t,r,n)];case 2:return[2,e.sent()]}})})},e.prototype.search=function(t,r){return o(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:if(!this.indexer)throw new ReferenceError("There not indexer available.");return[4,this.awaitForReady()];case 1:return e.sent(),[4,this.indexer.search(t,r)];case 2:return[2,e.sent()]}})})},e}(a.EventEmitter);t.default=m,t.setIndexer=function(e,t){v.set(e,t),v.set(d.nameOfNativeType(e),t)},t.setIndexerForColumn=function(e,t){b.set(e,t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.indexMapper=function(e){var t=new Set(e.split(/[\s,\.;\:"'!]/).filter(Boolean).map(function(e){return e.toLowerCase()}));return Array.from(t)},t}(r(0).default);t.default=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.indexMapper=function(e){return e.map(function(e){return JSON.stringify(e)})},t}(r(0).default);t.default=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.indexMapper=function(e){return[e]},t}(r(0).default);t.default=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(o,s,u,a){return new(u||(u=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},s=this&&this.__generator||function(r,n){var i,o,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,o=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=n.call(r,u)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.indexMapper=function(e){return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCDay()]},t.prototype.search=function(r,n){return o(this,void 0,void 0,function(){var t=this;return s(this,function(e){switch(e.label){case 0:return[4,this.search(r,n)];case 1:return[2,e.sent().filter(function(e){return e[t.key].getTime()===r.getTime()})]}})})},t}(r(0).default);t.default=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(o,s,u,a){return new(u||(u=Promise))(function(e,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(r,n)}i((a=a.apply(o,s||[])).next())})},s=this&&this.__generator||function(r,n){var i,o,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,o=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=n.call(r,u)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.indexMapper=function(e){return[e%3,e%5,e%7]},t.prototype.search=function(r,n){return o(this,void 0,void 0,function(){var t=this;return s(this,function(e){switch(e.label){case 0:return[4,this.search(r,n)];case 1:return[2,e.sent().filter(function(e){return e[t.key]===r})]}})})},t}(r(0).default);t.default=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.indexMapper=function(t){return Object.keys(t).map(function(e){return[e,JSON.stringify(t[e])]}).reduce(function(e,t){return e.concat(t)})},t}(r(0).default);t.default=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(t){function e(){var e=t.call(this)||this;return e.queue=[],e.running=!1,e}return i(e,t),e.prototype.push=function(e){var r=this,n=Math.random().toString(32).substr(2);return this.queue.push({task:e,id:n}),new Promise(function(e,t){r.once("task:"+n+":resolve",e),r.once("task:"+n+":reject",t)})},e.prototype.run=function(e){var t=this;if(!e&&this.running)return this;var r=this.queue.shift();if(r){var n=r.task,i=r.id;this.running=!0,n().then(function(e){t.emit("task:"+i+":resolve",e),t.run(t.running)}).catch(function(e){t.emit("task:"+i+":reject",e),t.run(t.running)})}else this.running=!1,this.emit("idle");return this},Object.defineProperty(e.prototype,"hasNext",{get:function(){return 0!==this.queue.length},enumerable:!0,configurable:!0}),e}(r(1).EventEmitter);t.default=o}])});
//# sourceMappingURL=model.map