!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Model=t()}(this,function(){"use strict";function e(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^\-/,"")}function t(e){return e=e.replace(/\-(\w{1})/g,function(e){return e[1].toUpperCase()}),e.replace(/^(\w{1})/,function(e){return e.toUpperCase()})}function r(e){return Ee.has(e)}function n(e){return Ee.has(e)?Ee.get(e):null}function o(e){if(Array.isArray(e))return Array;if(e instanceof Date)return Date;if(e instanceof RegExp)return RegExp;if(e instanceof Error)return Error;if(e instanceof(Map||Object))return Map||Object;if(e instanceof(WeakMap||Object))return WeakMap||Object;if(e instanceof(Set||Object))return Set||Object;if(e instanceof(WeakSet||Object))return WeakSet||Object;var t=!0,r=!1,n=void 0;try{for(var o,i=Ee.entries()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var u=o.value;if(u[1]===("undefined"==typeof e?"undefined":Ae["typeof"](e)))return u[0]}}catch(a){r=!0,n=a}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw n}}return Object}function i(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;t>n;n++)r[n-1]=arguments[n];var o=!0,i=!1,u=void 0;try{for(var a,s=r[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value,f=Object.keys(c),l=!0,h=!1,y=void 0;try{for(var p,v=f[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var d=p.value;c.hasOwnProperty(d)&&(e[d]=c[d])}}catch(m){h=!0,y=m}finally{try{!l&&v["return"]&&v["return"]()}finally{if(h)throw y}}}}catch(m){i=!0,u=m}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw u}}return e}function u(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function s(e){return"number"==typeof e}function c(e){return"object"===("undefined"==typeof e?"undefined":Ae["typeof"](e))&&null!==e}function f(e){return void 0===e}function l(){this.__data__=[]}function h(e,t){return e===t||e!==e&&t!==t}function y(e,t){for(var r=e.length;r--;)if(h(e[r][0],t))return r;return-1}function p(e){var t=this.__data__,r=y(t,e);if(0>r)return!1;var n=t.length-1;return r==n?t.pop():Te.call(t,r,1),!0}function v(e){var t=this.__data__,r=y(t,e);return 0>r?void 0:t[r][1]}function d(e){return y(this.__data__,e)>-1}function m(e,t){var r=this.__data__,n=y(r,e);return 0>n?r.push([e,t]):r[n][1]=t,this}function _(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function b(){this.__data__=new _}function g(e){return this.__data__["delete"](e)}function w(e){return this.__data__.get(e)}function j(e){return this.__data__.has(e)}function k(e){var t="undefined"==typeof e?"undefined":Ae["typeof"](e);return!!e&&("object"==t||"function"==t)}function x(e){var t=k(e)?De.call(e):"";return t==Re||t==qe}function O(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}function C(e){if(null!=e){try{return Ue.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function P(e){if(!k(e))return!1;var t=x(e)||O(e)?Ve:Be;return t.test(C(e))}function S(e,t){var r=e[t];return P(r)?r:void 0}function A(){this.__data__=Ke?Ke(null):{}}function E(e){return this.has(e)&&delete this.__data__[e]}function M(e){var t=this.__data__;if(Ke){var r=t[e];return r===ze?void 0:r}return Ge.call(t,e)?t[e]:void 0}function L(e){var t=this.__data__;return Ke?void 0!==t[e]:Ze.call(t,e)}function T(e,t){var r=this.__data__;return r[e]=Ke&&void 0===t?He:t,this}function R(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function q(e){return e&&e.Object===Object?e:null}function $(){this.__data__={hash:new R,map:new(ut||_),string:new R}}function D(e){var t="undefined"==typeof e?"undefined":Ae["typeof"](e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function U(e,t){var r=e.__data__;return D(t)?r["string"==typeof t?"string":"hash"]:r.map}function N(e){return U(this,e)["delete"](e)}function B(e){return U(this,e).get(e)}function F(e){return U(this,e).has(e)}function I(e,t){return U(this,e).set(e,t),this}function W(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function V(e,t){var r=this.__data__;return r instanceof _&&r.__data__.length==at&&(r=this.__data__=new W(r.__data__)),r.set(e,t),this}function K(e){this.__data__=new _(e)}function z(e){return this.__data__.set(e,st),this}function J(e){return this.__data__.has(e)}function G(e){var t=-1,r=e?e.length:0;for(this.__data__=new W;++t<r;)this.add(e[t])}function Y(e,t){for(var r=-1,n=e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Z(e,t,r,n,o,i){var u=o&ft,a=e.length,s=t.length;if(a!=s&&!(u&&s>a))return!1;var c=i.get(e);if(c)return c==t;var f=-1,l=!0,h=o&ct?new G:void 0;for(i.set(e,t);++f<a;){var y=e[f],p=t[f];if(n)var v=u?n(p,y,f,t,e,i):n(y,p,f,e,t,i);if(void 0!==v){if(v)continue;l=!1;break}if(h){if(!Y(t,function(e,t){return h.has(t)||y!==e&&!r(y,e,n,o,i)?void 0:h.add(t)})){l=!1;break}}else if(y!==p&&!r(y,p,n,o,i)){l=!1;break}}return i["delete"](e),l}function H(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function Q(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function X(e,t,r,n,o,i,u){switch(r){case Ot:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case xt:return!(e.byteLength!=t.byteLength||!n(new ht(e),new ht(t)));case vt:case dt:return+e==+t;case mt:return e.name==t.name&&e.message==t.message;case bt:return e!=+e?t!=+t:e==+t;case gt:case jt:return e==t+"";case _t:var a=H;case wt:var s=i&pt;if(a||(a=Q),e.size!=t.size&&!s)return!1;var c=u.get(e);return c?c==t:(i|=yt,u.set(e,t),Z(a(e),a(t),n,o,i,u));case kt:if(Pt)return Pt.call(e)==Pt.call(t)}return!1}function ee(e){return St(Object(e))}function te(e,t){return Et.call(e,t)||"object"==("undefined"==typeof e?"undefined":Ae["typeof"](e))&&t in e&&null===ee(e)}function re(e){return Mt(Object(e))}function ne(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function oe(e){return function(t){return null==t?void 0:t[e]}}function ie(e){return"number"==typeof e&&e>-1&&e%1==0&&Tt>=e}function ue(e){return null!=e&&ie(Lt(e))&&!x(e)}function ae(e){return!!e&&"object"==("undefined"==typeof e?"undefined":Ae["typeof"](e))}function se(e){return ae(e)&&ue(e)}function ce(e){return se(e)&&$t.call(e,"callee")&&(!Ut.call(e,"callee")||Dt.call(e)==Rt)}function fe(e){return"string"==typeof e||!Nt(e)&&ae(e)&&It.call(e)==Bt}function le(e){var t=e?e.length:void 0;return ie(t)&&(Nt(e)||fe(e)||ce(e))?ne(t,String):null}function he(e,t){return t=null==t?Wt:t,!!t&&("number"==typeof e||Vt.test(e))&&e>-1&&e%1==0&&t>e}function ye(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||Kt;return e===r}function pe(e){var t=ye(e);if(!t&&!ue(e))return re(e);var r=le(e),n=!!r,o=r||[],i=o.length;for(var u in e)!te(e,u)||n&&("length"==u||he(u,i))||t&&"constructor"==u||o.push(u);return o}function ve(e,t,r,n,o,i){var u=o&zt,a=pe(e),s=a.length,c=pe(t),f=c.length;if(s!=f&&!u)return!1;for(var l=s;l--;){var h=a[l];if(!(u?h in t:te(t,h)))return!1}var y=i.get(e);if(y)return y==t;var p=!0;i.set(e,t);for(var v=u;++l<s;){h=a[l];var d=e[h],m=t[h];if(n)var _=u?n(m,d,h,t,e,i):n(d,m,h,e,t,i);if(!(void 0===_?d===m||r(d,m,n,o,i):_)){p=!1;break}v||(v="constructor"==h)}if(p&&!v){var b=e.constructor,g=t.constructor;b!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g)&&(p=!1)}return i["delete"](e),p}function de(e){return or.call(e)}function me(e){return ae(e)&&ie(e.length)&&!!qr[Dr.call(e)]}function _e(e,t,r,n,o,i){var u=Nt(e),a=Nt(t),s=Br,c=Br;u||(s=fr(e),s=s==Nr?Fr:s),a||(c=fr(t),c=c==Nr?Fr:c);var f=s==Fr&&!O(e),l=c==Fr&&!O(t),h=s==c;if(h&&!f)return i||(i=new K),u||me(e)?Z(e,t,r,n,o,i):X(e,t,s,r,n,o,i);if(!(o&Ur)){var y=f&&Wr.call(e,"__wrapped__"),p=l&&Wr.call(t,"__wrapped__");if(y||p){var v=y?e.value():e,d=p?t.value():t;return i||(i=new K),r(v,d,n,o,i)}}return h?(i||(i=new K),ve(e,t,r,n,o,i)):!1}function be(e,t,r,n,o){return e===t?!0:null==e||null==t||!k(e)&&!ae(t)?e!==e&&t!==t:_e(e,t,be,r,n,o)}function ge(e,t){return be(e,t)}function we(e){return"number"==typeof e||ae(e)&&zr.call(e)==Vr}function je(e){return e===!0||e===!1||ae(e)&&Yr.call(e)==Jr}function ke(e){for(var t=new Set,r=arguments.length,n=Array(r>1?r-1:0),o=1;r>o;o++)n[o-1]=arguments[o];if(0===n.length)return e;var i=!0,u=!1,a=void 0;try{for(var s,c=function(){var e=s.value;0==n.map(function(t){return t.has(e)?0:1}).reduce(function(e,t){return e+t})&&t.add(e)},f=e[Symbol.iterator]();!(i=(s=f.next()).done);i=!0)c()}catch(l){u=!0,a=l}finally{try{!i&&f["return"]&&f["return"]()}finally{if(u)throw a}}return t}function xe(e){return x(e.then)&&x(e["catch"])}function Oe(e,t){var r=Ce(),n=new u;return r.search=function(e,r){return Oe(new Promise(function(o,i){n.once("ready",function(n){t.search(e,r,n,t).then(o)["catch"](i)})}),t)},e.then(function(e){r.resolve(e),n.emit("ready",e)}),r}function Ce(){var e=null,t=null,r=new Promise(function(r,n){e=r,t=n});return r.resolve=function(){for(var t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];e.apply(r,n)},r.reject=function(){for(var e=arguments.length,n=Array(e),o=0;e>o;o++)n[o]=arguments[o];t.apply(r,n)},r}function Pe(e,t){on.set(e,t),on.set(n(e),t)}function Se(e,t){un.set(e,t)}var Ae={};Ae["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},Ae.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ae.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Ae.defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},Ae.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Ae.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Ae.slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(s){o=!0,i=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Ae.toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)};var Ee=new Map([[String,"string"],[Number,"number"],[Boolean,"boolean"],[Object,"object"],[Array,"array"],[Date,"date"],[RegExp,"regexp"],[Error,"error"]]);u.EventEmitter=u,u.prototype._events=void 0,u.prototype._maxListeners=void 0,u.defaultMaxListeners=10,u.prototype.setMaxListeners=function(e){if(!s(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},u.prototype.emit=function(e){var t,r,n,o,i,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],f(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(c(r))for(o=Array.prototype.slice.call(arguments,1),u=r.slice(),n=u.length,i=0;n>i;i++)u[i].apply(this,o);return!0},u.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?c(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,c(this._events[e])&&!this._events[e].warned&&(r=f(this._maxListeners)?u.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},u.prototype.on=u.prototype.addListener,u.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!a(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},u.prototype.removeListener=function(e,t){var r,n,o,i;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(c(r)){for(i=o;i-- >0;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(0>n)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},u.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},u.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},u.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},u.listenerCount=function(e,t){return e.listenerCount(t)};var Me=function(e){function t(){Ae.classCallCheck(this,t);var e=Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.__queue=[],e.running=!1,e}return Ae.inherits(t,e),Ae.createClass(t,[{key:"push",value:function(e,t){return this.__queue.push({task:e,callback:t}),this}},{key:"run",value:function(e){var t=this;if(e||!this.running){var r=this.__queue.shift();return r?!function(){t.running=!0;var e=r.task,n=r.callback;e().then(function(){for(var e=arguments.length,r=Array(e),o=0;e>o;o++)r[o]=arguments[o];n.apply(void 0,[null].concat(r)),t.run(t.running)})["catch"](function(e){n(e),t.run(t.running)})}():(this.running=!1,this.emit("idle")),this}}},{key:"hasNext",get:function(){return 0!==this.__queue.length}}]),t}(u),Le=Array.prototype,Te=Le.splice;_.prototype.clear=l,_.prototype["delete"]=p,_.prototype.get=v,_.prototype.has=d,_.prototype.set=m;var Re="[object Function]",qe="[object GeneratorFunction]",$e=Object.prototype,De=$e.toString,Ue=Function.prototype.toString,Ne=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,Fe=Object.prototype,Ie=Function.prototype.toString,We=Fe.hasOwnProperty,Ve=RegExp("^"+Ie.call(We).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ke=S(Object,"create"),ze="__lodash_hash_undefined__",Je=Object.prototype,Ge=Je.hasOwnProperty,Ye=Object.prototype,Ze=Ye.hasOwnProperty,He="__lodash_hash_undefined__";R.prototype.clear=A,R.prototype["delete"]=E,R.prototype.get=M,R.prototype.has=L,R.prototype.set=T;var Qe={"function":!0,object:!0},Xe=Qe["undefined"==typeof exports?"undefined":Ae["typeof"](exports)]&&exports&&!exports.nodeType?exports:void 0,et=Qe["undefined"==typeof module?"undefined":Ae["typeof"](module)]&&module&&!module.nodeType?module:void 0,tt=q(Xe&&et&&"object"==("undefined"==typeof global?"undefined":Ae["typeof"](global))&&global),rt=q(Qe["undefined"==typeof self?"undefined":Ae["typeof"](self)]&&self),nt=q(Qe["undefined"==typeof window?"undefined":Ae["typeof"](window)]&&window),ot=q(Qe[Ae["typeof"](this)]&&this),it=tt||nt!==(ot&&ot.window)&&nt||rt||ot||Function("return this")(),ut=S(it,"Map");W.prototype.clear=$,W.prototype["delete"]=N,W.prototype.get=B,W.prototype.has=F,W.prototype.set=I;var at=200;K.prototype.clear=b,K.prototype["delete"]=g,K.prototype.get=w,K.prototype.has=j,K.prototype.set=V;var st="__lodash_hash_undefined__";G.prototype.add=G.prototype.push=z,G.prototype.has=J;var ct=1,ft=2,lt=it.Symbol,ht=it.Uint8Array,yt=1,pt=2,vt="[object Boolean]",dt="[object Date]",mt="[object Error]",_t="[object Map]",bt="[object Number]",gt="[object RegExp]",wt="[object Set]",jt="[object String]",kt="[object Symbol]",xt="[object ArrayBuffer]",Ot="[object DataView]",Ct=lt?lt.prototype:void 0,Pt=Ct?Ct.valueOf:void 0,St=Object.getPrototypeOf,At=Object.prototype,Et=At.hasOwnProperty,Mt=Object.keys,Lt=oe("length"),Tt=9007199254740991,Rt="[object Arguments]",qt=Object.prototype,$t=qt.hasOwnProperty,Dt=qt.toString,Ut=qt.propertyIsEnumerable,Nt=Array.isArray,Bt="[object String]",Ft=Object.prototype,It=Ft.toString,Wt=9007199254740991,Vt=/^(?:0|[1-9]\d*)$/,Kt=Object.prototype,zt=2,Jt=S(it,"DataView"),Gt=S(it,"Promise"),Yt=S(it,"Set"),Zt=S(it,"WeakMap"),Ht="[object Map]",Qt="[object Object]",Xt="[object Promise]",er="[object Set]",tr="[object WeakMap]",rr="[object DataView]",nr=Object.prototype,or=nr.toString,ir=C(Jt),ur=C(ut),ar=C(Gt),sr=C(Yt),cr=C(Zt);(Jt&&de(new Jt(new ArrayBuffer(1)))!=rr||ut&&de(new ut)!=Ht||Gt&&de(Gt.resolve())!=Xt||Yt&&de(new Yt)!=er||Zt&&de(new Zt)!=tr)&&(de=function(e){var t=or.call(e),r=t==Qt?e.constructor:void 0,n=r?C(r):void 0;if(n)switch(n){case ir:return rr;case ur:return Ht;case ar:return Xt;case sr:return er;case cr:return tr}return t});var fr=de,lr="[object Arguments]",hr="[object Array]",yr="[object Boolean]",pr="[object Date]",vr="[object Error]",dr="[object Function]",mr="[object Map]",_r="[object Number]",br="[object Object]",gr="[object RegExp]",wr="[object Set]",jr="[object String]",kr="[object WeakMap]",xr="[object ArrayBuffer]",Or="[object DataView]",Cr="[object Float32Array]",Pr="[object Float64Array]",Sr="[object Int8Array]",Ar="[object Int16Array]",Er="[object Int32Array]",Mr="[object Uint8Array]",Lr="[object Uint8ClampedArray]",Tr="[object Uint16Array]",Rr="[object Uint32Array]",qr={};qr[Cr]=qr[Pr]=qr[Sr]=qr[Ar]=qr[Er]=qr[Mr]=qr[Lr]=qr[Tr]=qr[Rr]=!0,qr[lr]=qr[hr]=qr[xr]=qr[yr]=qr[Or]=qr[pr]=qr[vr]=qr[dr]=qr[mr]=qr[_r]=qr[br]=qr[gr]=qr[wr]=qr[jr]=qr[kr]=!1;var $r=Object.prototype,Dr=$r.toString,Ur=2,Nr="[object Arguments]",Br="[object Array]",Fr="[object Object]",Ir=Object.prototype,Wr=Ir.hasOwnProperty,Vr="[object Number]",Kr=Object.prototype,zr=Kr.toString,Jr="[object Boolean]",Gr=Object.prototype,Yr=Gr.toString,Zr=function(e){function t(e,r,n,o){Ae.classCallCheck(this,t);var i=Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return i.sequence=e,i.prefix=r,i.key=n,i.__min=o,i.ready=!1,i}return Ae.inherits(t,e),Ae.createClass(t,[{key:"map",value:function(){var e=this;this.__min.exists(this.sequence).then(function(t){return t?e.__min.smembers(e.sequence):Promise.resolve([])}).then(function(t){var r=e.__min.multi();return t.forEach(function(t){return r.hget(e.prefix+":"+t,e.key)}),r.exec().then(function(e){return Promise.resolve(e.map(function(e,r){return[t[r],e]}))})}).then(function(t){return Promise.all(t.map(function(t){var r=Ae.slicedToArray(t,2),n=r[0],o=r[1],i=e.__min.multi(),u=e.indexMapper(o);if(Nt(u)){var a=u,s=!0,c=!1,f=void 0;try{for(var l,h=a[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var y=l.value;i.sadd(e.sequence+":"+e.key+":index:"+y,n)}}catch(p){c=!0,f=p}finally{try{!s&&h["return"]&&h["return"]()}finally{if(c)throw f}}return i.exec()}return xe(u)?u.then(function(t){var r=!0,o=!1,u=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;i.sadd(e.sequence+":"+e.key+":index:"+c,n)}}catch(f){o=!0,u=f}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw u}}return i.exec()}):void 0}))}).then(function(){e.ready=!0,e.emit("ready")})}},{key:"add",value:function(e,t){var r=this;return new Promise(function(e,n){var o=r.indexMapper(t);Nt(o)?e(o):xe(o)&&o.then(e)["catch"](n)}).then(function(t){var n=r.__min.multi(),o=!0,i=!1,u=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value;n.sadd(r.sequence+":"+r.key+":index:"+c,e)}}catch(f){i=!0,u=f}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw u}}return n.exec()})}},{key:"remove",value:function(e,t){var r=this;return new Promise(function(e,n){var o=r.indexMapper(t);if(Nt(o))e(o);else if(xe(o))return o.then(e)["catch"](n)}).then(function(t){var n=r.__min.multi(),o=!0,i=!1,u=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value;n.srem(r.sequence+":"+r.key+":index:"+c,e)}}catch(f){i=!0,u=f}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw u}}return n.exec()})}},{key:"reindex",value:function(e,t,r){var n=this;return this.remove(e,r).then(function(){return n.add(e,t)}).then(function(){return n.emit("updated"),Promise.resolve()})["catch"](function(e){return console.warn("[min-model WARN] "+e.message)})}},{key:"_search",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return new Promise(function(r,n){var o=t.indexMapper(e);Nt(o)?r(o):xe(o)&&o.then(function(e){r(e)})["catch"](n)}).then(function(e){return Promise.all(e.map(function(e){return t.__min.exists(t.sequence+":"+t.key+":index:"+e).then(function(r){return r?t.__min.smembers(t.sequence+":"+t.key+":index:"+e):Promise.resolve([])}).then(function(e){return Promise.resolve(new Set(e))})}))}).then(function(e){var n=ke.apply(void 0,Ae.toConsumableArray(e));return new Promise(function(e){r?e(r.map(function(e){return[e._key,e]})):t.__min.smembers(t.sequence).then(function(e){var r=t.__min.multi();return e.forEach(function(e){return r.hgetall(t.prefix+":"+e)}),r.exec().then(function(t){return Promise.resolve(t.map(function(t,r){return[e[r],t]}))})}).then(function(t){return e(t)})}).then(function(e){return Promise.resolve([e,n])})}).then(function(e){var t=Ae.slicedToArray(e,2),r=t[0],n=t[1];return Promise.resolve(r.filter(function(e){var t=Ae.slicedToArray(e,1),r=t[0];return n.has(r)}).map(function(e){var t=Ae.slicedToArray(e,2),r=t[0],n=t[1];return n._key=r,n}))})}},{key:"search",value:function(){return this._search.apply(this,arguments)}},{key:"indexMapper",value:function(){return[]}}]),t}(u),Hr=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){var t=new Set(e.split(/[\s,\.;\:"'!]/).filter(Boolean).map(function(e){return e.toLowerCase()}));return[].concat(Ae.toConsumableArray(t))}}]),t}(Zr),Qr=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){return[e%3,e%5,e%7]}},{key:"search",value:function(e,t){var r=this;return this._search(e,t).then(function(t){return Promise.resolve(t.filter(function(t){return t[r.key]===e}))})}}]),t}(Zr),Xr=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){return[e]}}]),t}(Zr),en=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){return Object.keys(e).map(function(t){return[t,JSON.stringify(e[t])]}).reduce(function(e,t){return e.concat(t)})}}]),t}(Zr),tn=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){return e.map(function(e){return JSON.stringify(e)})}}]),t}(Zr),rn=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){return[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCDay()]}},{key:"search",value:function(e,t){return this._search(e,t).then(function(t){return Promise.resolve(e.filter(function(t){return t.getTime()===e.getTime()}))})}}]),t}(Zr),nn=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:"indexMapper",value:function(e){var t=new Set(e.message.split(/[\s,\.;\:"'!]/).filter(Boolean).map(function(e){return e.toLowerCase()}));return[].concat(Ae.toConsumableArray(t))}}]),t}(Zr),on=new Map([["string",Hr],[String,Hr],["number",Qr],[Number,Qr],["boolean",Xr],[Boolean,Xr],["object",en],[Object,en],["array",tn],[Array,tn],["date",rn],[Date,rn],["error",nn],[Error,nn]]),un=new Map,an=function(e){function t(e,r,n,o,i){Ae.classCallCheck(this,t);var u=Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));switch(u.sequence=e,u.prefix=r,u.key=n,u.type=o,u.ready=!1,u.indexer=null,!0){case un.has(e+":"+n):u.indexer=new(un.get(e+":"+n))(e,r,n,i);break;case on.has(o):u.indexer=new(on.get(o))(e,r,n,i);break;default:throw new Error("Not support for this type.")}return u.indexer.map(),u.indexer.on("ready",function(){u.ready=!0,u.emit("ready")}).on("updated",function(){return u.emit("updated")}),u}return Ae.inherits(t,e),Ae.createClass(t,[{key:"add",value:function(e,t){var r=this;if(!this.indexer)throw new ReferenceError("There not indexer available.");return this.ready?this.indexer.add(e,t):new Promise(function(n,o){r.indexer.once("ready",function(){r.indexer.add(e,t).then(n)["catch"](o)})})}},{key:"remove",value:function(e,t){var r=this;if(!this.indexer)throw new ReferenceError("There not indexer available.");return this.ready?this.indexer.remove(e,t):new Promise(function(n,o){r.indexer.once("ready",function(){r.indexer.remove(e,t).then(n)["catch"](o)})})}},{key:"reindex",value:function(e,t,r){var n=this;if(!this.indexer)throw new ReferenceError("There not indexer available.");return this.ready?this.indexer.reindex(e,t,r):new Promise(function(o,i){n.indexer.once("ready",function(){n.indexer.reindex(e,t,r).then(o)["catch"](i)})})}},{key:"search",value:function(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments[2];if(!this.indexer)throw new ReferenceError("There not indexer available.");return this.ready?Oe(this.indexer.search(e,r),n):Oe(new Promise(function(n,o){t.indexer.once("ready",function(){t.indexer.search(e,r).then(n)["catch"](o)})}),n)}}]),t}(u),sn=Symbol("prefix"),cn=Symbol("sequence"),fn=Symbol("cache"),ln=Symbol("indexers"),hn=function(n){function u(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],t=arguments[1];Ae.classCallCheck(this,u);var r=Ae.possibleConstructorReturn(this,Object.getPrototypeOf(u).call(this));if(e&&t)r.key=e,r[fn]=t;else{if(t?r.key=e||Math.random().toString(32).substr(2):(t=e,r.key=Math.random().toString(32).substr(2)),r[fn]=i({},r.constructor.defaultData),r.$methods.beforeValidate){var n=r.$methods.beforeValidate.call(r,t);n&&(t=n)}var o=Object.keys(t),a=!0,s=!1,c=void 0;try{for(var f,l=o[Symbol.iterator]();!(a=(f=l.next()).done);a=!0){var h=f.value;if(!r.validate(h,t[h]))throw new TypeError('Type validate failed on column "'+h+'".')}}catch(y){s=!0,c=y}finally{try{!a&&l["return"]&&l["return"]()}finally{if(s)throw c}}r[fn]=i(r[fn],t)}var p=!0,v=!1,d=void 0;try{for(var m,_=function(){var e=m.value;r[e]=function(){for(var t,n=arguments.length,o=Array(n),i=0;n>i;i++)o[i]=arguments[i];return(t=r.constructor.$methods[e]).call.apply(t,[r].concat(o))}},b=Object.keys(r.constructor.$methods)[Symbol.iterator]();!(p=(m=b.next()).done);p=!0)_()}catch(y){v=!0,d=y}finally{try{!p&&b["return"]&&b["return"]()}finally{if(v)throw d}}return r.__queue.push(function(){return r.$methods.beforeStore&&r.$methods.beforeStore.call(r),r.__min.sadd(r.constructor.sequence,r.key).then(function(){return r.__min.hmset(r.hashKey,r[fn])}).then(function(){return Promise.all(Object.keys(r[fn]).map(function(e){return r.constructor[ln]&&r.constructor[ln].has(e)?r.constructor[ln].get(e).add(r.key,r[fn][e]):Promise.resolve()}))})},function(){r.$methods.ready&&r.$methods.ready.call(r),r.emit("ready",r)}),r.__queue.run(),r}return Ae.inherits(u,n),Ae.createClass(u,null,[{key:"use",value:function(e){this.__min=e}},{key:"setIndexer",value:function(e,t){Pe(e,t)}},{key:"setIndexerForColumn",value:function(e,t){Se(this.sequence+":"+e,t)}},{key:"extend",value:function(n,i){var a;if(n&&!i)throw new Error("Model.extend() should receive 2 arguments, but received 1.");if(!fe(n)&&!i)throw new Error("Model.extend() first argument must be a string.");var s=(a={},Ae.defineProperty(a,sn,e(n)),Ae.defineProperty(a,cn,e(n)+"s"),a),c={},f={},l={},h=!0,y=!1,p=void 0;try{for(var v,d=Object.keys(i)[Symbol.iterator]();!(h=(v=d.next()).done);h=!0){var m=v.value;!x(i[m])||r(i[m])?r(i[m])?(Nt(i[m])&&1===i[m].length&&x(i[m][0]),c[m]=i[m],f[m]=i[m]()):(c[m]=o(i[m]),f[m]=i[m]):l[m]=i[m]}}catch(_){y=!0,p=_}finally{try{!h&&d["return"]&&d["return"]()}finally{if(y)throw p}}var b=t(n),g=new Me,w=function(e){function t(){return Ae.classCallCheck(this,t),Ae.possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return Ae.inherits(t,e),Ae.createClass(t,[{key:Symbol.toStringTag,get:function(){return b}},{key:"__min",get:function(){return this.constructor.__min}},{key:"__queue",get:function(){return g}}],[{key:"modelName",get:function(){return b}},{key:"prefix",get:function(){return s[sn]}},{key:"sequence",get:function(){return s[cn]}},{key:"validateData",get:function(){return c}},{key:"defaultData",get:function(){return f}},{key:"$methods",get:function(){return l}}]),t}(u);return w}},{key:"BaseIndexer",get:function(){return Zr}}]),Ae.createClass(u,[{key:"getCacheData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return e?this[fn][e]:this[fn]}},{key:"get",value:function(e){var t=this;return this[fn][e]?Promise.resolve(this[fn][e]):this.__min.hget(this.hashKey,"key").then(function(r){return t[fn][e]=r,Promise.resolve(r)})}},{key:"set",value:function(e,t){var r=this;if(!this.validate(e,t))throw new TypeError("Type validate failed.");var n=this[fn][e];return this.$methods.beforeUpdate&&this.$methods.beforeUpdate.call(this,e,t,n),this[fn][e]=t,this.__min.hset(this.hashKey,e,t).then(function(){if(r.constructor[ln]&&r.constructor[ln].has(e)){var o=r.constructor[ln].get(e);return o.reindex(r.key,t,n)}return Promise.resolve()}).then(function(){r.$methods.afterUpdate&&r.$methods.afterUpdate.call(r,e,t,n),Promise.resolve([e,t])})}},{key:"reset",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(t)return this.set(t,this.constructor.defaultData[t]);var r=Object.keys(this.constructor.defaultData[t]);return Promise.all(r.map(function(t){return e.set(t,e.constructor.defaultData[t])}))}},{key:"remove",value:function(){var e=this;return this.$methods.beforeRemove&&this.$methods.beforeRemove.call(this),
this.__min.srem(this.constructor.sequence,this.key).then(function(){return e.__min.del(e.hashKey)}).then(function(){return Promise.all(Object.keys(e[fn]).map(function(t){return e.constructor[ln]&&e.constructor[ln].has(t)?e.constructor[ln].get(t).remove(e.key,e[fn][t]):Promise.resolve()}))}).then(function(){return e.key=null,e[fn]=null,e.$methods.afterRemove&&e.$methods.afterRemove.call(e),Promise.resolve()})}},{key:"validate",value:function(e,t){switch(this.constructor.validateData[e]){case String:return fe(t);case Number:return we(t);case Boolean:return je(t);default:return t instanceof(this.constructor.validateData[e]||Object)}}},{key:"hashKey",get:function(){return this.constructor.prefix+":"+this.key}},{key:"$methods",get:function(){return this.constructor.$methods}}],[{key:"fetch",value:function(e){var t=this;return this.__min.sismember(this.sequence,e).then(function(r){return r?t.__min.hgetall(t.prefix+":"+e):Promise.reject(new Error("Object not found."))}).then(function(r){return Promise.resolve(new t(e,r))})}},{key:"setIndex",value:function(e){this[ln]||(this[ln]=new Map);var t=this.validateData[e],r=new an(this.sequence,this.prefix,e,t,this.__min);return this[ln].set(e,r),r}},{key:"search",value:function(e,t){var r=this,n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];if(this[ln]&&this[ln].has(e)){var o=this[ln].get(e);return o.search(t,n,this).then(function(e){return e.map(function(e){return new r(e._key,e)})})}return this.__plainSearch(e,t,n).then(function(e){return e.map(function(e){return new r(e._key,e)})})}},{key:"__plainSearch",value:function(e,t){var r=this,n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return this.validateData[e]!==o(t)?Promise.reject(new TypeError("Type wrong")):Oe(new Promise(function(t,o){n?t(n.map(function(t){return[t._key,t[e]]})):r.__min.smembers(r.sequence).then(function(t){var n=r.__min.multi();return t.forEach(function(t){return n.hget(r.prefix+":"+t,e)}),n.exec().then(function(e){return Promise.resolve(e.map(function(e,r){return[t[r],e]}))})}).then(t)["catch"](o)}).then(function(n){return Promise.resolve(n.filter(function(n){var o=Ae.slicedToArray(n,2),i=(o[0],o[1]);return r.validateData[e]===String?i.includes(t):ge(i,t)}).map(function(e){var t=Ae.slicedToArray(e,2),r=t[0];t[1];return r}))}).then(function(e){var t=r.__min.multi();return e.forEach(function(e){return t.hgetall(r.prefix+":"+e)}),t.exec().then(function(t){return Promise.resolve(t.map(function(t,r){return t._key=e[r],t}))})}),this)}},{key:"dump",value:function(){var e=this;return this.__min.exists(this.sequence).then(function(t){return t?e.__min.smembers(e.sequence):Promise.resolve([])}).then(function(t){var r=e.__min.multi();return t.forEach(function(t){return r.hgetall(e.prefix+":"+t)}),r.exec().then(function(e){return Promise.resolve(e.map(function(e,r){return e._key=t[r],e}))})})}},{key:"allInstances",value:function(){var e=this;return this.dump().then(function(t){return Promise.resolve(t.map(function(t){return new e(t._key,t)}))})}}]),u}(u);return hn});
//# sourceMappingURL=model.js.map